<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Encabezado -->
<app-header></app-header>

<!-- Contenedor principal -->
<div class="mx-auto px-4 mt-[8rem] max-w-[95%] transition-all duration-300" [ngClass]="{ 
    'ml-56': isExpanded && isVisible, 
    'ml-20': !isExpanded && isVisible, 
    'ml-0': !isVisible}">
    <div class="max-w-[94rem] mx-auto mt-12">
        <!-- Título -->
        <div class="border-b border-gray-300 mb-4 h-auto">
            <div class="flex flex-col sm:flex-row justify-between items-center h-full p-4">
                <h1 class="font-bold text-2xl sm:text-3xl ml-2">Crear Nota</h1>
            </div>
        </div>

        <!-- Contenedor de los dos cuadros (uno vacío y uno con el formulario de notas) -->
        <div class="flex space-x-4">
            <!-- Cuadro vacío al lado izquierdo con las notas -->
            <div class="rounded-lg border border-gray-300 bg-white shadow-md w-1/3 h-auto">
                <div class="p-6">
                    <div class="form-group mb-4">
                        <label for="descripcion" class="text-lg font-semibold">Tus Notas</label>
                    </div>

                    <!-- Mostrar las notas del usuario -->
                    <div *ngIf="notas.length > 0; else noNotas">
                        <div *ngFor="let nota of notas"
                            class="nota-item mb-4 p-4 border-b border-gray-300 flex justify-between items-start cursor-pointer"
                            (click)="seleccionarNota(nota)"> <!-- Este es el contenedor que maneja la selección -->
                            <div class="flex flex-col w-full">
                                <p class="text-sm text-gray-600">{{ nota.descripcion }}</p>
                                <p class="text-xs text-gray-500 mt-2">{{ formatFecha(nota.created_at) }}</p>
                            </div>
                            <!-- Botón de eliminar -->
                            <button (click)="eliminarNota(nota.id); $event.stopPropagation()"
                                class="text-red-500 mt-2 ml-4 focus:outline-none">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Si no hay notas -->
                    <ng-template #noNotas>
                        <div class="text-center text-gray-500">
                            <p>No tienes notas creadas aún.</p>
                        </div>
                    </ng-template>
                </div>
            </div>

            <!-- Cuadro con el formulario de creación o actualización de nota -->
            <div class="rounded-lg border border-gray-300 bg-white shadow-md w-2/3 h-auto">
                <form (ngSubmit)="notaEditada ? actualizarNota() : crearNota()">
                    <div class="p-6">
                        <!-- Campo de descripción -->
                        <div class="form-group mb-4">
                            <label for="descripcion" class="text-lg font-semibold">{{ notaEditada ? 'Editar Nota' :
                                'Nueva Nota' }}</label>
                            <textarea id="descripcion" [(ngModel)]="nota.descripcion" name="descripcion" rows="4"
                                class="w-full p-3 border border-gray-300 rounded-md mt-2" required></textarea>
                        </div>

                        <!-- Botón para guardar o actualizar la nota -->
                        <button type="submit" [disabled]="!nota.descripcion"
                            class="bg-[#80BA27] text-white font-bold py-2 px-6 rounded-xl hover:bg-[#66a800] focus:outline-none mt-4">
                            {{ notaEditada ? 'Actualizar Nota' : 'Guardar Nota' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Mostrar mensaje de éxito o error -->
        <div *ngIf="mensaje" class="mensaje mt-4 text-center text-lg font-semibold text-red-500">
            {{ mensaje }}
        </div>
    </div>
</div>